- hosts: apt
  tasks:
    - name: Update cache on Debian and Ubuntu Servers
      apt:
       update_cache: yes
         
    - name: Upgrade all packages on Debian and Ubuntu servers
      apt: 
        name: "*"
        state: latest

- hosts: yum
  tasks:
    - name: Update and upgrade packages in Alma Linux Servers.
      dnf:
       name:  "*"
       state: latest


- hosts: apk
  tasks:
    - name: Update cache in Alpine Linux Servers
      community.general.apk:
          update_cache: true
    - name: Upgrade Alpine Linux packages.
      community.general.apk:
          upgrade: yes

    - name: Run Shell Command with Pipe and Capture Status
      shell: "set -o pipefail; apk list -I | grep '^linux-lts'; echo $?"
      register: pipe_status_result
      changed_when: false

    - name: Extract Exit Status from Result
      set_fact:
        pipe_exit_status: "{{ pipe_status_result.stdout_lines[-1] }}"

    - name: Print the value of the variable "pipe_exit_status"
      debug:
          var: pipe_exit_status

